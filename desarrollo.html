<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pizarra Digital Pro</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; font-family:'Segoe UI', sans-serif; background-color:#f0f0f0; }
body { display:flex; flex-direction:column; }
.tabs { display:flex; background-color:#0078d7; color:white; border-bottom:1px solid #ccc; }
.tab-button { padding:12px 20px; cursor:pointer; background-color:#0078d7; border:none; border-right:1px solid #005a9e; color:white; }
.tab-button.active { background-color:#106ebe; font-weight:bold; }
.tab-button:hover { background-color:#106ebe; }
.main { flex:1; display:flex; position:relative; overflow:hidden; }
.canvas-container { flex-grow:1; position:relative; background-color:white; margin:10px; border:1px solid #ccc; box-shadow:0 0 10px rgba(0,0,0,0.1); }
canvas { background-image: radial-gradient(#ccc 1px, transparent 1px); background-size:10px 10px; width:100%; height:100%; display:block; position:absolute; top:0; left:0; }
.toolbar { width:60px; background-color:#f5f5f5; border-left:1px solid #ccc; display:flex; flex-direction:column; align-items:center; padding-top:10px; box-shadow:-2px 0 5px rgba(0,0,0,0.1); }
.tool-button { margin:8px; padding:10px; background-color:#f5f5f5; border:1px solid #ccc; border-radius:4px; width:40px; height:40px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:16px; box-shadow:0 2px 3px rgba(0,0,0,0.1); }
.tool-button.active { background-color:#d9d9d9; border-color:#999; }
.tool-button:hover:not(.active) { background-color:#e9e9e9; }
.save-controls { margin-top:auto; padding:10px; display:flex; flex-direction:column; gap:5px; }
.sticky-note { position:absolute; background-color:#fffacd; padding:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); cursor:move; width:150px; z-index:5; border:1px solid #d4d4d4; }
.sticky-note-header { display:flex; justify-content:space-between; margin-bottom:5px; color:#333; }
.sticky-note-close { cursor:pointer; color:#666; }
.sticky-note-close:hover { color:#000; }
textarea { width:100%; height:60px; border:none; resize:none; background:transparent; font-family:'Segoe UI', sans-serif; }
</style>
</head>
<body>
<div class="tabs">
  <button class="tab-button active" data-tab="animate">Animate</button>
  <button class="tab-button" data-tab="development">Desarrollo</button>
  <button class="tab-button" data-tab="music">SC Music</button>
</div>
<div class="main">
  <div class="canvas-container" id="canvas-container">
    <canvas id="drawing-canvas"></canvas>
    <canvas id="preview-canvas"></canvas>
  </div>
  <div class="toolbar">
    <button class="tool-button active" id="select-tool" title="Seleccionar">üñ±Ô∏è</button>
    <button class="tool-button" id="pencil-tool" title="L√°piz">‚úèÔ∏è</button>
    <button class="tool-button" id="line-tool" title="L√≠nea">‚ûñ</button>
    <button class="tool-button" id="arrow-tool" title="Flecha">‚û°Ô∏è</button>
    <button class="tool-button" id="circle-tool" title="C√≠rculo">‚≠ï</button>
    <button class="tool-button" id="rectangle-tool" title="Rect√°ngulo">‚¨õ</button>
    <button class="tool-button" id="text-tool" title="Texto">üî§</button>
    <button class="tool-button" id="add-note" title="A√±adir Nota">üìù</button>
    <div class="save-controls">
      <button class="tool-button" id="clear-all" title="Limpiar Todo">üóëÔ∏è</button>
      <button class="tool-button" id="save-project" title="Guardar">üíæ</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('drawing-canvas');
const previewCanvas = document.getElementById('preview-canvas');
const ctx = canvas.getContext('2d');
const previewCtx = previewCanvas.getContext('2d');
const canvasContainer = document.getElementById('canvas-container');
const addNoteBtn = document.getElementById('add-note');
const tabs = document.querySelectorAll('.tab-button');
const toolButtons = document.querySelectorAll('.tool-button');
const clearAllBtn = document.getElementById('clear-all');
const saveProjectBtn = document.getElementById('save-project');

let isDrawing = false;
let currentTool = 'select';
let startX, startY;
let currentTab = 'animate';
let shapes = [];
let stickyNotes = [];
let currentPath = [];

function resizeCanvas() {
  canvas.width = canvasContainer.clientWidth;
  canvas.height = canvasContainer.clientHeight;
  previewCanvas.width = canvas.width;
  previewCanvas.height = canvas.height;
  redrawCanvas();
}

function redrawCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  shapes.filter(s=>s.tab===currentTab).forEach(drawShape);
}

function drawShape(shape) {
  ctx.beginPath();
  ctx.strokeStyle = shape.color||'#000';
  ctx.lineWidth = shape.lineWidth||2;
  switch(shape.type){
    case 'line': ctx.moveTo(shape.startX,shape.startY); ctx.lineTo(shape.endX,shape.endY); ctx.stroke(); break;
    case 'arrow': drawArrow(shape.startX,shape.startY,shape.endX,shape.endY); break;
    case 'rectangle': ctx.rect(shape.startX,shape.startY,shape.endX-shape.startX,shape.endY-shape.startY); ctx.stroke(); break;
    case 'circle': const r=Math.sqrt(Math.pow(shape.endX-shape.startX,2)+Math.pow(shape.endY-shape.startY,2)); ctx.arc(shape.startX,shape.startY,r,0,Math.PI*2); ctx.stroke(); break;
    case 'text': ctx.font=shape.font||'16px Arial'; ctx.fillStyle=shape.color||'#000'; ctx.fillText(shape.text,shape.startX,shape.startY); break;
    case 'pencil': if(shape.path.length>0){ ctx.beginPath(); ctx.moveTo(shape.path[0].x,shape.path[0].y); for(let i=1;i<shape.path.length;i++){ctx.lineTo(shape.path[i].x,shape.path[i].y);} ctx.stroke();} break;
  }
}

function drawArrow(fromX, fromY, toX, toY, context=ctx){
  const headLength=10;
  const angle=Math.atan2(toY-fromY,toX-fromX);
  context.beginPath();
  context.moveTo(fromX,fromY);
  context.lineTo(toX,toY);
  context.moveTo(toX,toY);
  context.lineTo(toX-headLength*Math.cos(angle-Math.PI/6),toY-headLength*Math.sin(angle-Math.PI/6));
  context.moveTo(toX,toY);
  context.lineTo(toX-headLength*Math.cos(angle+Math.PI/6),toY-headLength*Math.sin(angle+Math.PI/6));
  context.stroke();
}

function addStickyNote(x,y,id=null,text=''){
  const noteId=id||'note-'+Date.now();
  const note=document.createElement('div');
  note.className='sticky-note';
  note.id=noteId;
  note.style.left=x+'px';
  note.style.top=y+'px';
  note.dataset.tab=currentTab;
  note.innerHTML=`<div class="sticky-note-header"><span>Nota</span><span class="sticky-note-close" onclick="removeStickyNote('${noteId}')">‚úï</span></div><textarea>${text}</textarea>`;
  makeDraggable(note);
  canvasContainer.appendChild(note);
  stickyNotes.push({id:noteId,element:note,x:x,y:y,text:text,tab:currentTab});
  note.querySelector('textarea').addEventListener('input',(e)=>{
    const n=stickyNotes.find(n=>n.id===noteId); if(n) n.text=e.target.value;
  });
}

function removeStickyNote(id){
  const index=stickyNotes.findIndex(n=>n.id===id);
  if(index!==-1){ document.getElementById(id)?.remove(); stickyNotes.splice(index,1);}
}

function renderStickyNotes(){
  stickyNotes.forEach(n=>n.element.style.display=n.tab===currentTab?'block':'none');
}

function makeDraggable(el){
  let offsetX,offsetY,isDragging=false;
  el.addEventListener('mousedown',e=>{
    isDragging=true;
    offsetX=e.clientX-el.getBoundingClientRect().left;
    offsetY=e.clientY-el.getBoundingClientRect().top;
    document.addEventListener('mousemove',onMove);
    document.addEventListener('mouseup',onUp);
  });
  function onMove(e){ if(!isDragging) return; el.style.left=(e.clientX-offsetX)+'px'; el.style.top=(e.clientY-offsetY)+'px'; const n=stickyNotes.find(n=>n.id===el.id); if(n){n.x=e.clientX-offsetX; n.y=e.clientY-offsetY;} }
  function onUp(){ isDragging=false; document.removeEventListener('mousemove',onMove); document.removeEventListener('mouseup',onUp);}
}

function addText(x,y){
  const text=prompt("Ingrese el texto:");
  if(text){ shapes.push({type:'text',startX:x,startY:y,text:text,color:'#000',font:'16px Arial',tab:currentTab}); redrawCanvas(); }
}

function saveProject(){
  const project={shapes:shapes,stickyNotes:stickyNotes.map(n=>({id:n.id,x:n.x,y:n.y,text:n.text,tab:n.tab}))};
  localStorage.setItem('pizarraProject',JSON.stringify(project));
  alert('Proyecto guardado correctamente.');
}

function loadProject(){
  const saved=localStorage.getItem('pizarraProject');
  if(saved){
    const p=JSON.parse(saved);
    shapes=p.shapes||[];
    stickyNotes.forEach(n=>document.getElementById(n.id)?.remove());
    stickyNotes=[];
    p.stickyNotes.forEach(n=>addStickyNote(n.x,n.y,n.id,n.text));
    redrawCanvas();
    renderStickyNotes();
  }
}

function clearAll(){
  if(confirm('¬øEst√°s seguro de que quieres limpiar todo en esta pesta√±a?')){
    shapes=shapes.filter(s=>s.tab!==currentTab);
    stickyNotes=stickyNotes.filter(n=>{
      if(n.tab===currentTab){ document.getElementById(n.id)?.remove(); return false; }
      return true;
    });
    redrawCanvas();
  }
}

window.addEventListener('resize',resizeCanvas);

tabs.forEach(tab=>{
  tab.addEventListener('click',()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    currentTab=tab.dataset.tab;
    renderStickyNotes();
    redrawCanvas();
  });
});

toolButtons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    toolButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentTool=btn.id.replace('-tool','');
  });
});

canvas.addEventListener('mousedown',e=>{
  const rect=canvas.getBoundingClientRect();
  startX=e.clientX-rect.left;
  startY=e.clientY-rect.top;
  if(currentTool==='text-tool'){ addText(startX,startY); }
  else if(currentTool==='pencil'){ isDrawing=true; currentPath=[{x:startX,y:startY}]; previewCtx.clearRect(0,0,previewCanvas.width,previewCanvas.height); previewCtx.beginPath(); previewCtx.moveTo(startX,startY); previewCtx.strokeStyle='#000'; previewCtx.lineWidth=2; }
  else if(currentTool!=='select'){ isDrawing=true; previewCtx.clearRect(0,0,previewCanvas.width,previewCanvas.height); previewCtx.beginPath(); previewCtx.strokeStyle='#000'; previewCtx.lineWidth=2; }
});

canvas.addEventListener('mousemove',e=>{
  if(!isDrawing) return;
  const rect=canvas.getBoundingClientRect();
  const currentX=e.clientX-rect.left;
  const currentY=e.clientY-rect.top;

  previewCtx.clearRect(0,0,previewCanvas.width,previewCanvas.height);
  previewCtx.beginPath();
  previewCtx.strokeStyle='#000';
  previewCtx.lineWidth=2;

  if(currentTool==='pencil'){
    currentPath.push({x:currentX,y:currentY});
    previewCtx.moveTo(currentPath[0].x,currentPath[0].y);
    for(let i=1;i<currentPath.length;i++){ previewCtx.lineTo(currentPath[i].x,currentPath[i].y);}
    previewCtx.stroke();
  } else if(currentTool!=='select' && currentTool!=='text-tool'){
    switch(currentTool){
      case 'line': previewCtx.moveTo(startX,startY); previewCtx.lineTo(currentX,currentY); break;
      case 'arrow': drawArrow(startX,startY,currentX,currentY,previewCtx); break;
      case 'rectangle': previewCtx.rect(startX,startY,currentX-startX,currentY-startY); break;
      case 'circle': const r=Math.sqrt(Math.pow(currentX-startX,2)+Math.pow(currentY-startY,2)); previewCtx.arc(startX,startY,r,0,Math.PI*2); break;
    }
    previewCtx.stroke();
  }
});

canvas.addEventListener('mouseup',e=>{
  if(!isDrawing || currentTool==='text-tool') return;
  isDrawing=false;
  const rect=canvas.getBoundingClientRect();
  const endX=e.clientX-rect.left;
  const endY=e.clientY-rect.top;

  if(currentTool==='pencil'){ shapes.push({type:'pencil',path:currentPath,color:'#000',lineWidth:2,tab:currentTab}); }
  else if(currentTool!=='select'){ shapes.push({type:currentTool,startX:startX,startY:startY,endX:endX,endY:endY,color:'#000',lineWidth:2,tab:currentTab}); }

  previewCtx.clearRect(0,0,previewCanvas.width,previewCanvas.height);
  redrawCanvas();
});

addNoteBtn.addEventListener('click',e=>{
  const rect=canvas.getBoundingClientRect();
  addStickyNote(rect.left+50,rect.top+50);
});

clearAllBtn.addEventListener('click',clearAll);
saveProjectBtn.addEventListener('click',saveProject);

window.addEventListener('load',()=>{ resizeCanvas(); loadProject(); });

</script>
</body>
</html>
