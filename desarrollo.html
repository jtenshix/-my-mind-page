<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convertidor Links Drive ‚Üí Imagen (con categor√≠as)</title>
  <style>
    :root{
      --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
      --panel: rgba(0,0,0,.85);
      --txt:#f5f5f5; --accent:#ffcc70; --accent-hover:#ffaa00;
      --disc:#18a558; /* verde discograf√≠a */
      --movie:#d9534f;/* rojo movie */
      --news:#3b82f6; /* azul news */
    }
    *{ box-sizing:border-box }
    body{
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      color: var(--txt);
      margin:0; padding:0;
      min-height:100vh; display:flex; justify-content:center; align-items:center;
    }
    .container{
      background: var(--panel);
      padding: 26px;
      border-radius: 14px;
      width: min(92vw, 780px);
      box-shadow: 0 10px 30px rgba(0,0,0,.6);
    }
    h1{ font-size: 22px; margin: 0 0 18px; color: var(--accent); text-align:center }
    .row{ display:grid; gap:12px; }
    label{ font-size:13px; opacity:.9 }
    input[type="text"], textarea{
      width: 100%; padding: 10px 12px; border-radius: 10px; border: none;
      font-size: 14px; background: #111; color: #fff; outline: none;
    }
    textarea{ height: 70px; resize: none }
    .btns{ display:flex; flex-wrap:wrap; gap:8px; margin-top:6px }
    button{
      padding: 9px 14px; border: none; border-radius: 10px;
      background: var(--accent); color:#222; font-size:14px; cursor:pointer; transition:.25s;
    }
    button:hover{ background: var(--accent-hover) }

    /* Selector de categor√≠a con ‚Äúchips‚Äù de color */
    .cats{
      display:flex; gap:10px; flex-wrap:wrap; margin: 6px 0 2px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      background: #111; border: 2px solid transparent; color:#fff;
      border-radius: 999px; padding:7px 12px; cursor:pointer; user-select:none;
      transition:.2s;
    }
    .chip input{ display:none }
    .dot{ width:12px; height:12px; border-radius:999px }
    .chip[data-cat="discografia"] .dot{ background: var(--disc) }
    .chip[data-cat="movie"]       .dot{ background: var(--movie) }
    .chip[data-cat="news"]        .dot{ background: var(--news) }
    .chip.active[data-cat="discografia"]{ border-color: var(--disc) }
    .chip.active[data-cat="movie"]      { border-color: var(--movie) }
    .chip.active[data-cat="news"]       { border-color: var(--news) }

    .preview{ margin-top: 14px; text-align:center }
    .preview img{ max-width:100%; border-radius:12px; border:2px solid #444 }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    @media (max-width:720px){ .grid2{ grid-template-columns: 1fr } }
    .small{ font-size:12px; opacity:.8; margin-top:3px }
    .outblock{ background:#0b0b0b; padding:12px; border-radius:10px; border:1px solid #222 }
    .title-row{ display:grid; gap:8px; grid-template-columns: 1fr 140px }
    @media (max-width:560px){ .title-row{ grid-template-columns: 1fr } }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîó Convertidor Google Drive ‚Üí Imagen</h1>

    <div class="row" style="margin-bottom:14px">
      <label for="driveLink">Pega tu link de Google Drive</label>
      <input id="driveLink" type="text" placeholder="https://drive.google.com/file/d/ABC123.../view?usp=sharing" />
      <div class="btns">
        <button id="btnConvertir">Convertir</button>
        <button id="btnCopiarUrl">Copiar URL directa</button>
      </div>
    </div>

    <div class="row outblock">
      <label>Resultado (URL directa de imagen)</label>
      <textarea id="resultado" readonly></textarea>
      <div class="preview" id="preview"></div>
    </div>

    <div class="row" style="margin-top:16px">
      <label>Selecciona la categor√≠a (colores):</label>
      <div class="cats" id="cats">
        <label class="chip" data-cat="discografia"><input type="radio" name="cat" value="discografia"><span class="dot"></span> Discograf√≠a</label>
        <label class="chip" data-cat="movie"><input type="radio" name="cat" value="movie"><span class="dot"></span> Movie</label>
        <label class="chip" data-cat="news"><input type="radio" name="cat" value="news"><span class="dot"></span> News</label>
      </div>
      <div class="small">Esto solo define el campo <code>"destino"</code> para pegarlo en tu <code>catalogo.json</code>.</div>
    </div>

    <div class="row grid2" style="margin-top:10px">
      <div class="outblock">
        <div class="title-row">
          <div>
            <label for="titulo">T√≠tulo (opcional, para tu JSON)</label>
            <input id="titulo" type="text" placeholder="Ej: Nuevo wallpaper / Nueva canci√≥n" />
          </div>
          <div>
            <label for="clave">Clave de noticia</label>
            <input id="clave" type="text" value="n1" />
          </div>
        </div>
        <div class="btns" style="margin-top:10px">
          <button id="btnGenerarJson">Generar JSON</button>
          <button id="btnCopiarJson">Copiar JSON</button>
        </div>
        <label class="small">Fragmento para <code>"news"</code> en tu <code>catalogo.json</code>:</label>
        <textarea id="salidaJson" readonly></textarea>
      </div>

      <div class="outblock">
        <label>Destino directo (si prefieres forzar URL en vez de alias)</label>
        <div class="btns" style="margin-top:6px">
          <button id="btnDestinoDisc">discografia</button>
          <button id="btnDestinoMovie">movie</button>
          <button id="btnDestinoNews">news</button>
        </div>
        <div class="small">Tambi√©n puedes usar <code>"link"</code> directo (por ejemplo tu p√°gina de news absoluta).</div>
        <div class="btns" style="margin-top:10px">
          <button id="btnGenerarJsonLink">Generar JSON con link</button>
          <button id="btnCopiarJsonLink">Copiar JSON con link</button>
        </div>
        <textarea id="salidaJsonLink" readonly></textarea>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <div class="small">Alias v√°lidos y c√≥mo los usas en tu web:</div>
      <div class="outblock">
        <pre style="margin:0; white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12.5px; color:#ddd">
discografia ‚Üí "Discography.html"
movie       ‚Üí "movie.html"
news        ‚Üí "https://jtenshix.github.io/J-tenshi-music/news.html"
        </pre>
      </div>
    </div>
  </div>

  <script>
    // --- Helpers ---
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    function extraerIdDrive(link){
      if(!link) return null;
      // Busca ID por patrones comunes
      const m = link.match(/[-\\w]{25,}/);
      return m ? m[0] : null;
    }

    function aDirectLink(fileId){
      return `https://lh3.googleusercontent.com/d/${fileId}`;
    }

    function copiarTexto(el){
      el.select();
      document.execCommand("copy");
    }

    // --- Persistencia simple de categor√≠a ---
    const CAT_KEY = "tenshi_cat";
    function getCat(){
      return localStorage.getItem(CAT_KEY) || "discografia";
    }
    function setCat(cat){
      localStorage.setItem(CAT_KEY, cat);
    }

    // --- UI init: activar chip guardado ---
    (function initChips(){
      const catInicial = getCat();
      const chips = $$("#cats .chip");
      chips.forEach(ch => {
        const val = ch.getAttribute("data-cat");
        const input = ch.querySelector('input[type="radio"]');
        if(val === catInicial) { ch.classList.add("active"); input.checked = true; }
        ch.addEventListener("click", () => {
          chips.forEach(c => c.classList.remove("active"));
          ch.classList.add("active");
          input.checked = true;
          setCat(val);
        });
      });
    })();

    // --- Botones principales ---
    $("#btnConvertir").addEventListener("click", () => {
      const link = $("#driveLink").value.trim();
      const id = extraerIdDrive(link);
      if(!id){
        alert("‚ùå Link no v√°lido. Revisa que sea un link de Google Drive.");
        return;
      }
      const url = aDirectLink(id);
      $("#resultado").value = url;
      $("#preview").innerHTML = `<p style="margin:6px 0 8px">Vista previa:</p><img src="${url}" alt="Preview">`;
    });

    $("#btnCopiarUrl").addEventListener("click", () => copiarTexto($("#resultado")));

    // --- Generar JSON usando 'destino' (alias de color/categor√≠a) ---
    $("#btnGenerarJson").addEventListener("click", () => {
      const url = $("#resultado").value.trim();
      if(!url){ alert("Convierte primero el link para obtener la URL directa."); return; }
      const titulo = $("#titulo").value.trim();
      const clave  = $("#clave").value.trim() || "n1";
      const destino = getCat(); // discografia | movie | news

      // Construye objeto
      const obj = { imagen: url, destino };
      if(titulo) obj.titulo = titulo;

      // Render bonito
      const json = `"${clave}": ${JSON.stringify(obj, null, 2)}`;
      $("#salidaJson").value = json;
    });

    $("#btnCopiarJson").addEventListener("click", () => copiarTexto($("#salidaJson")));

    // --- Botones destino directo (para JSON con 'link') ---
    const DESTINOS = {
      discografia: "Discography.html",
      movie: "movie.html",
      news: "https://jtenshix.github.io/J-tenshi-music/news.html"
    };
    $("#btnDestinoDisc").addEventListener("click", ()=> setCat("discografia"));
    $("#btnDestinoMovie").addEventListener("click", ()=> setCat("movie"));
    $("#btnDestinoNews").addEventListener("click", ()=> setCat("news"));

    // --- Generar JSON usando 'link' directo en vez de 'destino' ---
    $("#btnGenerarJsonLink").addEventListener("click", () => {
      const url = $("#resultado").value.trim();
      if(!url){ alert("Convierte primero el link para obtener la URL directa."); return; }
      const titulo = $("#titulo").value.trim();
      const clave  = $("#clave").value.trim() || "n1";
      const cat    = getCat();
      const link   = DESTINOS[cat] || "#";

      const obj = { imagen: url, link };
      if(titulo) obj.titulo = titulo;

      const json = `"${clave}": ${JSON.stringify(obj, null, 2)}`;
      $("#salidaJsonLink").value = json;
    });

    $("#btnCopiarJsonLink").addEventListener("click", () => copiarTexto($("#salidaJsonLink")));
  </script>
</body>
</html>
