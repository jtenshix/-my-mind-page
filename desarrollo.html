<!DOCTYPE html>
<html lang="es">
<head>
ย <meta charset="UTF-8">
ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย <title>Pizarra Digital Pro</title>
ย <style>
ย ย * {
ย ย ย margin: 0;
ย ย ย padding: 0;
ย ย ย box-sizing: border-box;
ย ย }

ย ย html, body {
ย ย ย height: 100%;
ย ย ย font-family: 'Segoe UI', sans-serif;
ย ย }

ย ย body {
ย ย ย display: flex;
ย ย ย flex-direction: column;
ย ย }

ย ย .tabs {
ย ย ย display: flex;
ย ย ย background-color: #ececec;
ย ย ย border-bottom: 1px solid #ccc;
ย ย }

ย ย .tab-button {
ย ย ย padding: 12px 20px;
ย ย ย cursor: pointer;
ย ย ย background-color: #e2e2e2;
ย ย ย border: none;
ย ย ย border-right: 1px solid #ccc;
ย ย }

ย ย .tab-button.active {
ย ย ย background-color: #d0d0d0;
ย ย ย font-weight: bold;
ย ย }

ย ย .main {
ย ย ย flex: 1;
ย ย ย display: flex;
ย ย ย position: relative;
ย ย ย overflow: hidden;
ย ย }

ย ย .canvas-container {
ย ย ย flex-grow: 1;
ย ย ย position: relative;
ย ย }

ย ย canvas {
ย ย ย background-image: radial-gradient(#ccc 1px, transparent 0);
ย ย ย background-size: 20px 20px;
ย ย ย width: 100%;
ย ย ย height: 100%;
ย ย ย display: block;
ย ย }

ย ย .toolbar {
ย ย ย width: 80px;
ย ย ย background-color: #f0f0f0;
ย ย ย border-left: 1px solid #ccc;
ย ย ย display: flex;
ย ย ย flex-direction: column;
ย ย ย align-items: center;
ย ย ย padding-top: 10px;
ย ย }

ย ย .tool-button {
ย ย ย margin: 6px;
ย ย ย padding: 10px;
ย ย ย background-color: #fff;
ย ย ย border: 1px solid #aaa;
ย ย ย border-radius: 4px;
ย ย ย width: 50px;
ย ย ย text-align: center;
ย ย ย cursor: pointer;
ย ย ย font-size: 12px;
ย ย }

ย ย .tool-button.active {
ย ย ย background-color: #bbb;
ย ย }

ย ย .tool-button:hover {
ย ย ย background-color: #ddd;
ย ย }

ย ย .save-controls {
ย ย ย margin-top: auto;
ย ย ย padding: 10px;
ย ย ย display: flex;
ย ย ย flex-direction: column;
ย ย ย gap: 5px;
ย ย }

ย ย .sticky-note {
ย ย ย position: absolute;
ย ย ย background-color: #ffeb3b;
ย ย ย padding: 10px;
ย ย ย border-radius: 5px;
ย ย ย box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
ย ย ย cursor: move;
ย ย ย width: 150px;
ย ย }

ย ย .sticky-note-header {
ย ย ย display: flex;
ย ย ย justify-content: space-between;
ย ย ย margin-bottom: 5px;
ย ย }

ย ย .sticky-note-close {
ย ย ย cursor: pointer;
ย ย }

ย ย .text-input {
ย ย ย position: absolute;
ย ย ย border: 1px solid #ccc;
ย ย ย background-color: white;
ย ย ย padding: 5px;
ย ย ย z-index: 10;
ย ย }
ย </style>
</head>
<body>
ย <div class="tabs">
ย ย <button class="tab-button active" data-tab="animate">Animate</button>
ย ย <button class="tab-button" data-tab="development">Desarrollo</button>
ย ย <button class="tab-button" data-tab="music">SC Music</button>
ย </div>
ย <div class="main">
ย ย <div class="canvas-container">
ย ย ย <canvas id="drawing-canvas"></canvas>
ย ย </div>
ย ย <div class="toolbar">
ย ย ย <button class="tool-button active" id="select-tool">Sel</button>
ย ย ย <button class="tool-button" id="pencil-tool">โ๏ธ</button>
ย ย ย <button class="tool-button" id="line-tool">/</button>
ย ย ย <button class="tool-button" id="arrow-tool">โก๏ธ</button>
ย ย ย <button class="tool-button" id="circle-tool">โช</button>
ย ย ย <button class="tool-button" id="rectangle-tool">โญ</button>
ย ย ย <button class="tool-button" id="text-tool">A</button>
ย ย ย <button class="tool-button" id="checkbox-tool">โ๏ธ</button>
ย ย ย <button class="tool-button" id="add-note">๐</button>

ย ย ย <div class="save-controls">
ย ย ย ย <button class="tool-button" id="clear-all">๐๏ธ</button>
ย ย ย ย <button class="tool-button" id="save-project">๐พ</button>
ย ย ย ย <button class="tool-button" id="export-project">๐ค</button>
ย ย ย ย <input type="file" id="import-project-input" accept=".json" style="display: none;">
ย ย ย ย <button class="tool-button" id="import-project">๐ฅ</button>
ย ย ย </div>
ย ย </div>
ย </div>

ย <script>
ย ย const canvas = document.getElementById('drawing-canvas');
ย ย const ctx = canvas.getContext('2d');
ย ย let shapes = [];
ย ย let stickyNotes = [];
ย ย let isDrawing = false;
ย ย let currentTool = 'select';
ย ย let startX, startY;
ย ย let currentTab = 'animate';
ย ย let isDraggingNote = false;
ย ย let draggedNote = null;
ย ย let offsetX, offsetY;
ย ย let textInput = null;

ย ย function resizeCanvas() {
ย ย ย canvas.width = window.innerWidth - 80;
ย ย ย canvas.height = window.innerHeight - 42;
ย ย ย redrawCanvas();
ย ย }

ย ย function redrawCanvas() {
ย ย ย ctx.clearRect(0, 0, canvas.width, canvas.height);
ย ย ย shapes.filter(shape => shape.tab === currentTab).forEach(shape => {
ย ย ย ย drawShape(shape);
ย ย ย });
ย ย }

ย ย function drawShape(shape) {
ย ย ย ctx.beginPath();
ย ย ย ctx.strokeStyle = shape.color || '#000';
ย ย ย ctx.lineWidth = shape.lineWidth || 2;

ย ย ย switch (shape.type) {
ย ย ย ย case 'line':
ย ย ย ย ย ctx.moveTo(shape.startX, shape.startY);
ย ย ย ย ย ctx.lineTo(shape.endX, shape.endY);
ย ย ย ย ย break;
ย ย ย ย case 'arrow':
ย ย ย ย ย drawArrow(shape.startX, shape.startY, shape.endX, shape.endY);
ย ย ย ย ย break;
ย ย ย ย case 'circle':
ย ย ย ย ย const radius = Math.sqrt(Math.pow(shape.endX - shape.startX, 2) + Math.pow(shape.endY - shape.startY, 2));
ย ย ย ย ย ctx.arc(shape.startX, shape.startY, radius, 0, Math.PI * 2);
ย ย ย ย ย break;
ย ย ย ย case 'rectangle':
ย ย ย ย ย ctx.rect(shape.startX, shape.startY, shape.endX - shape.startX, shape.endY - shape.startY);
ย ย ย ย ย break;
ย ย ย ย case 'text':
ย ย ย ย ย ctx.font = shape.font || '16px Arial';
ย ย ย ย ย ctx.fillStyle = shape.color || '#000';
ย ย ย ย ย ctx.fillText(shape.text, shape.startX, shape.startY);
ย ย ย ย ย break;
ย ย ย ย case 'pencil': // Lรณgica para dibujar trazos de lรกpiz si se guardaran
ย ย ย ย ย if (shape.points && shape.points.length > 1) {
ย ย ย ย ย ย ctx.moveTo(shape.points[0].x, shape.points[0].y);
ย ย ย ย ย ย for (let i = 1; i < shape.points.length; i++) {
ย ย ย ย ย ย ย ctx.lineTo(shape.points[i].x, shape.points[i].y);
ย ย ย ย ย ย }
ย ย ย ย ย }
ย ย ย ย ย break;
ย ย ย }
ย ย ย ctx.stroke();
ย ย }

ย ย function drawArrow(fromX, fromY, toX, toY) {
ย ย ย const headLength = 10;
ย ย ย const angle = Math.atan2(toY - fromY, toX - fromX);

ย ย ย ctx.moveTo(fromX, fromY);
ย ย ย ctx.lineTo(toX, toY);
ย ย ย ctx.moveTo(toX, toY);
ย ย ย ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
ย ย ย ctx.moveTo(toX, toY);
ย ย ย ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
ย ย }

ย ย function addStickyNote(x, y) {
ย ย ย const noteId = 'note-' + Date.now();
ย ย ย const note = document.createElement('div');
ย ย ย note.className = 'sticky-note';
ย ย ย note.id = noteId;
ย ย ย note.style.left = x + 'px';
ย ย ย note.style.top = y + 'px';
ย ย ย note.innerHTML = `
ย ย ย ย <div class="sticky-note-header">
ย ย ย ย ย <span>Nota</span>
ย ย ย ย ย <span class="sticky-note-close" onclick="removeStickyNote('${noteId}')">โ</span>
ย ย ย ย </div>
ย ย ย ย <textarea style="width: 100%; border: none; resize: none; background: transparent;"></textarea>
ย ย ย `;
ย ย ย document.body.appendChild(note);

ย ย ย stickyNotes.push({
ย ย ย ย id: noteId,
ย ย ย ย x: x,
ย ย ย ย y: y,
ย ย ย ย tab: currentTab
ย ย ย });

ย ย ย makeDraggable(note);
ย ย }

ย ย function makeDraggable(element) {
ย ย ย element.addEventListener('mousedown', function(e) {
ย ย ย ย isDraggingNote = true;
ย ย ย ย draggedNote = element;
ย ย ย ย offsetX = e.clientX - element.getBoundingClientRect().left;
ย ย ย ย offsetY = e.clientY - element.getBoundingClientRect().top;
ย ย ย });
ย ย }

ย ย function removeStickyNote(noteId) {
ย ย ย const note = document.getElementById(noteId);
ย ย ย if (note) {
ย ย ย ย note.remove();
ย ย ย ย stickyNotes = stickyNotes.filter(n => n.id !== noteId);
ย ย ย }
ย ย }

ย ย function addText(x, y) {
ย ย ย const text = prompt("Ingrese el texto:");
ย ย ย if (text) {
ย ย ย ย shapes.push({
ย ย ย ย ย type: 'text',
ย ย ย ย ย startX: x,
ย ย ย ย ย startY: y,
ย ย ย ย ย text: text,
ย ย ย ย ย color: '#000',
ย ย ย ย ย font: '16px Arial',
ย ย ย ย ย tab: currentTab
ย ย ย ย });
ย ย ย ย redrawCanvas();
ย ย ย }
ย ย }

ย ย window.addEventListener('mousemove', function(e) {
ย ย ย if (isDraggingNote && draggedNote) {
ย ย ย ย draggedNote.style.left = (e.clientX - offsetX) + 'px';
ย ย ย ย draggedNote.style.top = (e.clientY - offsetY) + 'px';
ย ย ย }
ย ย });

ย ย window.addEventListener('mouseup', function() {
ย ย ย isDraggingNote = false;
ย ย ย draggedNote = null;
ย ย });

ย ย window.addEventListener('resize', resizeCanvas);
ย ย resizeCanvas();

ย ย document.querySelectorAll('.tab-button').forEach(button => {
ย ย ย button.addEventListener('click', function() {
ย ย ย ย document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
ย ย ย ย this.classList.add('active');
ย ย ย ย currentTab = this.getAttribute('data-tab');
ย ย ย ย redrawCanvas();
ย ย ย ย document.querySelectorAll('.sticky-note').forEach(note => {
ย ย ย ย ย note.style.display = stickyNotes.find(n => n.id === note.id && n.tab === currentTab) ? 'block' : 'none';
ย ย ย ย });
ย ย ย });
ย ย });

ย ย document.querySelectorAll('.tool-button').forEach(btn => {
ย ย ย btn.addEventListener('click', () => {
ย ย ย ย document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
ย ย ย ย btn.classList.add('active');
ย ย ย ย currentTool = btn.id.replace('-tool', '');
ย ย ย });
ย ย });

ย ย document.getElementById('add-note').addEventListener('click', () => {
ย ย ย const rect = canvas.getBoundingClientRect();
ย ย ย addStickyNote(rect.left + 50, rect.top + 50);
ย ย });

ย ย canvas.addEventListener('mousedown', (e) => {
ย ย ย const rect = canvas.getBoundingClientRect();
ย ย ย startX = e.clientX - rect.left;
ย ย ย startY = e.clientY - rect.top;

ย ย ย if (currentTool === 'text') { // Cambiado de 'text-tool' a 'text'
ย ย ย ย addText(startX, startY);
ย ย ย } else {
ย ย ย ย isDrawing = true;
ย ย ย ย if (currentTool === 'pencil') { // Nuevo: Inicia una nueva ruta para el lรกpiz
ย ย ย ย ย ctx.beginPath();
ย ย ย ย ย ctx.moveTo(startX, startY);
ย ย ย ย }
ย ย ย }
ย ย });

ย ย canvas.addEventListener('mousemove', (e) => {
ย ย ย if (!isDrawing) return;
ย ย ย const rect = canvas.getBoundingClientRect();
ย ย ย const currentX = e.clientX - rect.left;
ย ย ย const currentY = e.clientY - rect.top;

ย ย ย // Modificado: No redibujar para lรกpiz, para que el trazo sea continuo
ย ย ย if (currentTool !== 'pencil') {
ย ย ย ย redrawCanvas();
ย ย ย }
ย ย ย 
ย ย ย ctx.strokeStyle = '#000';
ย ย ย ctx.lineWidth = 2;

ย ย ย switch (currentTool) {
ย ย ย ย case 'pencil': // Nuevo: Lรณgica para dibujar a mano alzada
ย ย ย ย ย ctx.lineTo(currentX, currentY);
ย ย ย ย ย ctx.stroke();
ย ย ย ย ย break;
ย ย ย ย case 'line':
ย ย ย ย case 'arrow':
ย ย ย ย ย redrawCanvas();
ย ย ย ย ย ctx.beginPath();
ย ย ย ย ย ctx.moveTo(startX, startY);
ย ย ย ย ย ctx.lineTo(currentX, currentY);
ย ย ย ย ย if (currentTool === 'arrow') {
ย ย ย ย ย ย drawArrow(startX, startY, currentX, currentY);
ย ย ย ย ย }
ย ย ย ย ย ctx.stroke();
ย ย ย ย ย break;
ย ย ย ย case 'circle':
ย ย ย ย ย redrawCanvas();
ย ย ย ย ย ctx.beginPath();
ย ย ย ย ย const radius = Math.sqrt(Math.pow(currentX - startX, 2) + Math.pow(currentY - startY, 2));
ย ย ย ย ย ctx.arc(startX, startY, radius, 0, Math.PI * 2);
ย ย ย ย ย ctx.stroke();
ย ย ย ย ย break;
ย ย ย ย case 'rectangle':
ย ย ย ย ย redrawCanvas();
ย ย ย ย ย ctx.beginPath();
ย ย ย ย ย ctx.rect(startX, startY, currentX - startX, currentY - startY);
ย ย ย ย ย ctx.stroke();
ย ย ย ย ย break;
ย ย ย }
ย ย });

ย ย canvas.addEventListener('mouseup', (e) => {
ย ย ย if (!isDrawing || currentTool === 'text') return; // Cambiado de 'text-tool' a 'text'
ย ย ย isDrawing = false;

ย ย ย const rect = canvas.getBoundingClientRect();
ย ย ย const endX = e.clientX - rect.left;
ย ย ย const endY = e.clientY - rect.top;

ย ย ย if (currentTool !== 'pencil') { // Si no es el lรกpiz, guarda la forma
ย ย ย ย shapes.push({
ย ย ย ย ย type: currentTool,
ย ย ย ย ย startX: startX,
ย ย ย ย ย startY: startY,
ย ย ย ย ย endX: endX,
ย ย ย ย ย endY: endY,
ย ย ย ย ย color: '#000',
ย ย ย ย ย lineWidth: 2,
ย ย ย ย ย tab: currentTab
ย ย ย ย });
ย ย ย } else {
ย ย ย ย // Para la herramienta 'pencil', no se aรฑade una forma en mouseup tal cual.
ย ย ย ย // Si quieres guardar los trazos de lรกpiz para persistir, necesitarรญas
ย ย ย ย // una lรณgica diferente (acumular puntos en mousemove y guardarlos aquรญ).
ย ย ย ย // Tu cรณdigo actual ya dibuja el lรกpiz en tiempo real.
ย ย ย }
ย ย ย redrawCanvas();
ย ย });

ย ย document.getElementById('clear-all').addEventListener('click', () => {
ย ย ย shapes = shapes.filter(shape => shape.tab !== currentTab);
ย ย ย stickyNotes = stickyNotes.filter(note => note.tab !== currentTab);
ย ย ย document.querySelectorAll('.sticky-note').forEach(note => {
ย ย ย ย if (note.style.display !== 'none') {
ย ย ย ย ย note.remove();
ย ย ย ย }
ย ย ย });
ย ย ย redrawCanvas();
ย ย });

ย ย document.getElementById('save-project').addEventListener('click', () => {
ย ย ย localStorage.setItem('pizarra-save', JSON.stringify({ shapes, stickyNotes }));
ย ย ย alert('Guardado localmente');
ย ย });

ย ย document.getElementById('export-project').addEventListener('click', () => {
ย ย ย const data = canvas.toDataURL('image/png');
ย ย ย const link = document.createElement('a');
ย ย ย link.href = data;
ย ย ย link.download = 'pizarra.png';
ย ย ย link.click();
ย ย });

ย ย document.getElementById('import-project').addEventListener('click', () => {
ย ย ย document.getElementById('import-project-input').click();
ย ย });

ย ย document.getElementById('import-project-input').addEventListener('change', (e) => {
ย ย ย const file = e.target.files[0];
ย ย ย const reader = new FileReader();
ย ย ย reader.onload = (event) => {
ย ย ย ย const data = JSON.parse(event.target.result);
ย ย ย ย shapes = data.shapes || [];
ย ย ย ย stickyNotes = data.stickyNotes || [];
ย ย ย ย redrawCanvas();
ย ย ย ย stickyNotes.forEach(note => {
ย ย ย ย ย addStickyNote(note.x, note.y);
ย ย ย ย });
ย ย ย };
ย ย ย reader.readAsText(file);
ย ย });
ย </script>
</body>
</html>
