<!DOCTYPE html>

<html lang="es">

<head>

Â  <meta charset="UTF-8" />

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  <title>Notas OceÃ¡nicas - Polaroid</title>

Â  <!-- Firebase -->

Â  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>

Â  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>

Â  <!-- GridStack CSS & JS -->

Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@8.3.0/dist/gridstack.min.css" />

Â  <script src="https://cdn.jsdelivr.net/npm/gridstack@8.3.0/dist/gridstack-all.js"></script>

Â  <style>

Â  Â  /* ===================== Estilos Globales ===================== */

Â  Â  html, body {

Â  Â  Â  margin: 0;

Â  Â  Â  padding: 0;

Â  Â  Â  height: 100vh;

Â  Â  Â  overflow: hidden;

Â  Â  Â  background: linear-gradient(to bottom, #a2dff7 0%, #a2dff7 40%, #03254c 100%);

Â  Â  Â  font-family: Arial, sans-serif;

Â  Â  }

Â  Â  /* Contenedor principal: se deja un padding de 2cm en todas direcciones */

Â  Â  .container {

Â  Â  Â  height: 100%;

Â  Â  Â  width: 100%;

Â  Â  Â  padding: 2cm;

Â  Â  Â  box-sizing: border-box;

Â  Â  Â  display: flex;

Â  Â  Â  flex-direction: column;

Â  Â  Â  align-items: center;

Â  Â  Â  justify-content: center;

Â  Â  Â  position: relative;

Â  Â  }

Â  Â  /* Ãrea de notas (GridStack) ocupa el total del contenedor */

Â  Â  #notaDisplay {

Â  Â  Â  margin: 0;

Â  Â  Â  width: 100%;

Â  Â  Â  height: 100%;

Â  Â  }

Â  Â  .grid-stack-placeholder { display: none !important; }

Â  Â  .grid-stack-item { transition: transform 0.4s cubic-bezier(0.25,1,0.5,1); }



Â  Â  /* ===================== Tarjetas de Nota ===================== */

Â  Â  .card-wrapper, .text-card {

Â  Â  Â  background-color: #fff;

Â  Â  Â  border: 2px solid #0077a3;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2);

Â  Â  Â  width: 240px;

Â  Â  Â  display: flex;

Â  Â  Â  flex-direction: column;

Â  Â  Â  position: relative;

Â  Â  }

Â  Â  .card-content { flex-grow: 1; }

Â  Â  .image-container {

Â  Â  Â  width: 240px;

Â  Â  Â  height: 240px;

Â  Â  Â  overflow: hidden;

Â  Â  Â  position: relative;

Â  Â  }

Â  Â  .image-container img {

Â  Â  Â  width: 100%;

Â  Â  Â  height: 100%;

Â  Â  Â  object-fit: cover;

Â  Â  Â  display: block;

Â  Â  }

Â  Â  .note-content {

Â  Â  Â  background-color: #fff;

Â  Â  Â  padding: 10px;

Â  Â  Â  text-align: left;

Â  Â  Â  font-size: 16px;

Â  Â  Â  color: #333;

Â  Â  Â  min-height: 50px;

Â  Â  Â  box-sizing: border-box;

Â  Â  Â  word-wrap: break-word;

Â  Â  Â  overflow: hidden;

Â  Â  }

Â  Â  .note-content a { color: #0077a3; text-decoration: underline; }



Â  Â  /* ===================== Ãrea de Controles de la Nota ===================== */

Â  Â  .menu-bar {

Â  Â  Â  background-color: #0288D1;

Â  Â  Â  padding: 5px;

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: flex-end;

Â  Â  Â  align-items: center;

Â  Â  }

Â  Â  .menu-icon {

Â  Â  Â  background: none;

Â  Â  Â  border: none;

Â  Â  Â  font-size: 20px;

Â  Â  Â  color: #fff;

Â  Â  Â  cursor: pointer;

Â  Â  Â  margin-left: 4px;

Â  Â  }

Â  Â  /* BotÃ³n de la bolita: se le asignarÃ¡ un id para identificarla (ej. "bubble-<doc.id>") */

Â  Â  .bubble-icon {

Â  Â  Â  color: #FFCD05;

Â  Â  Â  font-size: 22px;

Â  Â  Â  margin-right: 8px;

Â  Â  }



Â  Â  /* ===================== BotÃ³n Principal para Agregar Nota/Imagen ===================== */

Â  Â  #addNoteButton {

Â  Â  Â  position: absolute;

Â  Â  Â  bottom: 20px;

Â  Â  Â  right: 20px;

Â  Â  Â  background-color: #006994;

Â  Â  Â  color: #fff;

Â  Â  Â  border: none;

Â  Â  Â  border-radius: 50%;

Â  Â  Â  width: 60px;

Â  Â  Â  height: 60px;

Â  Â  Â  font-size: 30px;

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: center;

Â  Â  Â  align-items: center;

Â  Â  Â  cursor: pointer;

Â  Â  Â  box-shadow: 0 3px 8px rgba(0,0,0,0.3);

Â  Â  Â  transition: background-color 0.3s ease, transform 0.3s ease;

Â  Â  Â  z-index: 4;

Â  Â  }

Â  Â  #addNoteButton:hover {

Â  Â  Â  background-color: #005577;

Â  Â  Â  transform: scale(1.05);

Â  Â  }



Â  Â  /* ===================== MenÃº Emergente ===================== */

Â  Â  #addNoteOptions {

Â  Â  Â  position: absolute;

Â  Â  Â  top: 50%;

Â  Â  Â  left: 50%;

Â  Â  Â  transform: translate(-50%, -50%);

Â  Â  Â  background-color: rgba(0,0,0,0.8);

Â  Â  Â  border-radius: 10px;

Â  Â  Â  box-shadow: 0 3px 8px rgba(0,0,0,0.3);

Â  Â  Â  display: none;

Â  Â  Â  flex-direction: row;

Â  Â  Â  justify-content: center;

Â  Â  Â  align-items: center;

Â  Â  Â  gap: 20px;

Â  Â  Â  padding: 20px;

Â  Â  Â  z-index: 4;

Â  Â  }

Â  Â  #addNoteOptions .card {

Â  Â  Â  background-color: #1e1e1e;

Â  Â  Â  border: 2px solid #0077a3;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  padding: 20px;

Â  Â  Â  text-align: center;

Â  Â  Â  cursor: pointer;

Â  Â  Â  transition: transform 0.3s ease;

Â  Â  Â  width: 200px;

Â  Â  }

Â  Â  #addNoteOptions .card:hover { transform: scale(1.05); }

Â  Â  #addNoteOptions .card h2 { color: #0077a3; margin-bottom: 10px; }

Â  Â  #addNoteOptions .card p { color: #fff; font-size: 14px; }



Â  Â  /* ===================== SubmenÃº para Ingresar Datos ===================== */

Â  Â  #inputArea {

Â  Â  Â  position: absolute;

Â  Â  Â  top: 50%;

Â  Â  Â  left: 50%;

Â  Â  Â  transform: translate(-50%, -50%);

Â  Â  Â  background-color: rgba(255,255,255,0.95);

Â  Â  Â  padding: 20px;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  box-shadow: 0 3px 8px rgba(0,0,0,0.3);

Â  Â  Â  flex-direction: column;

Â  Â  Â  gap: 10px;

Â  Â  Â  width: 80%;

Â  Â  Â  max-width: 500px;

Â  Â  Â  z-index: 4;

Â  Â  Â  display: none;

Â  Â  }

Â  Â  #inputArea textarea,

Â  Â  #inputArea input[type="text"] {

Â  Â  Â  padding: 10px;

Â  Â  Â  border: 1px solid #ccc;

Â  Â  Â  border-radius: 4px;

Â  Â  Â  resize: none;

Â  Â  Â  width: 100%;

Â  Â  Â  box-sizing: border-box;

Â  Â  Â  line-height: 1.5;

Â  Â  }

Â  Â  #inputArea button {

Â  Â  Â  padding: 10px 15px;

Â  Â  Â  background-color: #006994;

Â  Â  Â  color: #fff;

Â  Â  Â  border: none;

Â  Â  Â  border-radius: 4px;

Â  Â  Â  cursor: pointer;

Â  Â  Â  transition: background-color 0.3s ease;

Â  Â  }

Â  Â  #inputArea button:hover { background-color: #005577; }

Â  Â  .input-group { display: flex; flex-direction: column; gap: 5px; }



Â  Â  /* ===================== Calendario ===================== */

Â  Â  .calendar-icon {

Â  Â  Â  position: absolute;

Â  Â  Â  bottom: 20px;

Â  Â  Â  left: 20px;

Â  Â  Â  width: 40px;

Â  Â  Â  height: 40px;

Â  Â  Â  background-color: #fff;

Â  Â  Â  border: 1px solid #ccc;

Â  Â  Â  border-radius: 50%;

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: center;

Â  Â  Â  align-items: center;

Â  Â  Â  color: #333;

Â  Â  Â  font-size: 20px;

Â  Â  Â  cursor: pointer;

Â  Â  Â  z-index: 4;

Â  Â  }

Â  Â  .calendar-widget {

Â  Â  Â  position: absolute;

Â  Â  Â  bottom: 70px;

Â  Â  Â  left: 20px;

Â  Â  Â  background: #fff;

Â  Â  Â  border: 1px solid #ddd;

Â  Â  Â  padding: 10px;

Â  Â  Â  display: none;

Â  Â  Â  z-index: 4;

Â  Â  Â  width: 300px;Â  Â  Â  /* Calendario un poco mÃ¡s ancho */

Â  Â  Â  min-height: 220px; /* Mayor altura mÃ­nima */

Â  Â  }

Â  Â  .calendar-header {

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: space-between;

Â  Â  Â  align-items: center;

Â  Â  Â  margin-bottom: 5px;

Â  Â  }

Â  Â  .calendar-header button {

Â  Â  Â  background: none;

Â  Â  Â  border: none;

Â  Â  Â  cursor: pointer;

Â  Â  Â  font-size: 16px;

Â  Â  Â  color: #333;

Â  Â  }

Â  Â  .calendar-header span { font-weight: bold; color: #333; }

Â  Â  .calendar-days-header,

Â  Â  .calendar-dates-grid {

Â  Â  Â  display: grid;

Â  Â  Â  grid-template-columns: repeat(7, 1fr);

Â  Â  Â  text-align: center;

Â  Â  Â  font-size: 12px;

Â  Â  Â  gap: 4px 0; /* SeparaciÃ³n vertical de 4px */

Â  Â  }

Â  Â  .calendar-days-header { margin-bottom: 5px; font-weight: bold; color: #333; }

Â  Â  .calendar-day,

Â  Â  .calendar-date {

Â  Â  Â  padding: 3px;

Â  Â  Â  border-radius: 3px;

Â  Â  Â  color: #333;

Â  Â  Â  border: 1px solid transparent;

Â  Â  }

Â  Â  .calendar-date.empty { background: none; }

Â  Â  .calendar-date:hover { background-color: #e0e0e0; }

Â  Â  /* Indicador de la bolita asignada en el calendario */

Â  Â  .assigned-bubble {

Â  Â  Â  color: #FFCD05;

Â  Â  Â  font-size: 20px;

Â  Â  Â  display: block;

Â  Â  Â  margin: auto;

Â  Â  Â  margin-top: 4px;

Â  Â  }



Â  Â  /* ===================== Capa para Cerrar MenÃºs (Blur) ===================== */

Â  Â  .blur-background {

Â  Â  Â  position: fixed;

Â  Â  Â  top: 0;

Â  Â  Â  left: 0;

Â  Â  Â  width: 100%;

Â  Â  Â  height: 100%;

Â  Â  Â  background: rgba(0,0,0,0.5);

Â  Â  Â  backdrop-filter: blur(5px);

Â  Â  Â  display: none;

Â  Â  Â  z-index: 3;

Â  Â  }

Â  </style>

</head>

<body>

Â  <div class="container">

Â  Â  <!-- Ãrea de Notas usando GridStack -->

Â  Â  <div id="notaDisplay" class="grid-stack"></div>

Â  Â Â 

Â  Â  <!-- BotÃ³n Principal para Agregar Nota/Imagen -->

Â  Â  <button id="addNoteButton">+</button>

Â  Â Â 

Â  Â  <!-- MenÃº Emergente: Seleccionar entre Imagen o Nota -->

Â  Â  <div id="addNoteOptions">

Â  Â  Â  <div class="card" id="addImageLinkOption">

Â  Â  Â  Â  <h2>Imagen</h2>

Â  Â  Â  Â  <p>Guardar link de imagen.</p>

Â  Â  Â  </div>

Â  Â  Â  <div class="card" id="addTextNoteOption">

Â  Â  Â  Â  <h2>Nota</h2>

Â  Â  Â  Â  <p>Subir nota de texto.</p>

Â  Â  Â  </div>

Â  Â  </div>

Â  Â Â 

Â  Â  <!-- SubmenÃº para Ingresar Datos -->

Â  Â  <div id="inputArea">

Â  Â  Â  <div id="imageLinkInputArea">

Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  <label for="imageLink">Link de la imagen:</label>

Â  Â  Â  Â  Â  <input type="text" id="imageLink" placeholder="Ej: https://..." />

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  <label for="imageNoteText">Texto de la imagen (opcional):</label>

Â  Â  Â  Â  Â  <textarea id="imageNoteText" placeholder="DescripciÃ³n o nota..."></textarea>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button id="saveImageLink">Guardar Link</button>

Â  Â  Â  </div>

Â  Â  Â  <div id="textNoteInputArea">

Â  Â  Â  Â  <textarea id="textNote" placeholder="Escribe tu nota aquÃ­..."></textarea>

Â  Â  Â  Â  <button id="saveTextNote">Guardar Nota</button>

Â  Â  Â  </div>

Â  Â  </div>

Â  Â Â 

Â  Â  <!-- Calendario: Icono y Widget -->

Â  Â  <div id="calendarIcon" class="calendar-icon">â˜°</div>

Â  Â  <div id="calendarWidget" class="calendar-widget"></div>

Â  Â Â 

Â  Â  <!-- Capa para detectar clics fuera y cerrar menÃºs -->

Â  Â  <div class="blur-background"></div>

Â  </div>



Â  <script>

Â  Â  /****************** Utilidades y ConfiguraciÃ³n de Firebase ******************/

Â  Â  function transformDriveLink(url) {

Â  Â  Â  if (!url.includes("drive.google.com")) return url;

Â  Â  Â  let fileId = null;

Â  Â  Â  const regex1 = /\/file\/d\/([^\/]+)\//;

Â  Â  Â  let match = url.match(regex1);

Â  Â  Â  if (match && match[1]) fileId = match[1];

Â  Â  Â  if (!fileId) {

Â  Â  Â  Â  const regex2 = /[?&]id=([^&]+)/;

Â  Â  Â  Â  match = url.match(regex2);

Â  Â  Â  Â  if (match && match[1]) fileId = match[1];

Â  Â  Â  }

Â  Â  Â  return fileId ? "https://drive.google.com/uc?export=view&id=" + fileId : url;

Â  Â  }

Â  Â  function linkify(text) {

Â  Â  Â  if (!text) return "";

Â  Â  Â  const replacedText = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');

Â  Â  Â  return replacedText.replace(/\n/g, '<br>');

Â  Â  }

Â  Â  const firebaseConfig = {

Â  Â  Â  apiKey: "AIzaSyCHa373WgLLHsy8wZXK9zr_HVieQvlrhUs",

Â  Â  Â  authDomain: "oasis-b036d.firebaseapp.com",

Â  Â  Â  projectId: "oasis-b036d",

Â  Â  Â  storageBucket: "oasis-b036d.appspot.com",

Â  Â  Â  messagingSenderId: "141546637821",

Â  Â  Â  appId: "1:141546637821:web:0a861aeb13831774ed3194",

Â  Â  Â  measurementId: "G-HB2P17H5YL"

Â  Â  };

Â  Â  firebase.initializeApp(firebaseConfig);

Â  Â  const db = firebase.firestore();



Â  Â  /****************** InicializaciÃ³n de GridStack ******************/

Â  Â  const grid = GridStack.init({

Â  Â  Â  margin: 75, // Aproximadamente 2cm en pÃ­xeles (ajustado para homogeneidad)

Â  Â  Â  cellHeight: 'auto',

Â  Â  Â  disableResize: true,

Â  Â  Â  float: true,

Â  Â  Â  animate: true,

Â  Â  Â  alwaysShowResizeHandle: true,

Â  Â  Â  draggable: { handle: '.menu-bar' }

Â  Â  });



Â  Â  function autoResizeTextarea(el) {

Â  Â  Â  el.style.height = 'auto';

Â  Â  Â  el.style.height = el.scrollHeight + 'px';

Â  Â  }

Â  Â  const textNoteInput = document.getElementById('textNote');

Â  Â  const imageNoteText = document.getElementById('imageNoteText');

Â  Â  textNoteInput.addEventListener('input', () => autoResizeTextarea(textNoteInput));

Â  Â  imageNoteText.addEventListener('input', () => autoResizeTextarea(imageNoteText));



Â  Â  /****************** RenderizaciÃ³n de Notas ******************/

Â  Â  function mostrarNotaEnPantalla(doc) {

Â  Â  Â  const notaData = doc.data();

Â  Â  Â  const gridItem = document.createElement('div');

Â  Â  Â  gridItem.classList.add('grid-stack-item');

Â  Â  Â  gridItem.setAttribute('data-note-id', doc.id);

Â  Â  Â  const content = document.createElement('div');

Â  Â  Â  let card, noteContent = document.createElement('div');



Â  Â  Â  if (notaData.url) {

Â  Â  Â  Â  card = document.createElement('div');

Â  Â  Â  Â  card.classList.add('card-wrapper');

Â  Â  Â  Â  const imageContainer = document.createElement('div');

Â  Â  Â  Â  imageContainer.classList.add('image-container');

Â  Â  Â  Â  const img = document.createElement('img');

Â  Â  Â  Â  img.src = transformDriveLink(notaData.url);

Â  Â  Â  Â  img.alt = 'Imagen de la nota';

Â  Â  Â  Â  imageContainer.appendChild(img);

Â  Â  Â  Â  card.appendChild(imageContainer);

Â  Â  Â  Â  noteContent = document.createElement('div');

Â  Â  Â  Â  noteContent.classList.add('note-content');

Â  Â  Â  Â  noteContent.innerHTML = notaData.texto ? linkify(notaData.texto) : '';

Â  Â  Â  Â  card.appendChild(noteContent);

Â  Â  Â  } else if (notaData.nota) {

Â  Â  Â  Â  card = document.createElement('div');

Â  Â  Â  Â  card.classList.add('text-card');

Â  Â  Â  Â  noteContent = document.createElement('div');

Â  Â  Â  Â  noteContent.classList.add('note-content');

Â  Â  Â  Â  noteContent.innerHTML = linkify(notaData.nota);

Â  Â  Â  Â  card.appendChild(noteContent);

Â  Â  Â  }

Â  Â  Â  for (let link of noteContent.getElementsByTagName('a')) {

Â  Â  Â  Â  link.setAttribute('target', '_blank');

Â  Â  Â  }

Â  Â  Â Â 

Â  Â  Â  /***** Ãrea de Controles de la Nota *****/

Â  Â  Â  const menuBar = document.createElement('div');

Â  Â  Â  menuBar.classList.add('menu-bar');



Â  Â  Â  // BotÃ³n de la bolita (draggable) â€“ se le asigna id Ãºnico basado en doc.id

Â  Â  Â  const bubbleButton = document.createElement('button');

Â  Â  Â  bubbleButton.classList.add('menu-icon', 'bubble-icon');

Â  Â  Â  bubbleButton.innerHTML = 'â—';

Â  Â  Â  bubbleButton.setAttribute('draggable', 'true');

Â  Â  Â  bubbleButton.id = "bubble-" + doc.id;

Â  Â  Â  bubbleButton.addEventListener('dragstart', function(e) {

Â  Â  Â  Â  var img = new Image();

Â  Â  Â  Â  img.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PboX9AAAAABJRU5ErkJggg==';

Â  Â  Â  Â  e.dataTransfer.setDragImage(img, 0, 0);

Â  Â  Â  Â  // Se transfiere el id de la nota

Â  Â  Â  Â  e.dataTransfer.setData("application/note-id", doc.id);

Â  Â  Â  Â  openCalendar();

Â  Â  Â  });

Â  Â  Â  bubbleButton.addEventListener('click', function(e) {

Â  Â  Â  Â  openCalendar();

Â  Â  Â  });

Â  Â  Â  // BotÃ³n de editar

Â  Â  Â  const editButton = document.createElement('button');

Â  Â  Â  editButton.classList.add('menu-icon');

Â  Â  Â  editButton.innerHTML = 'âœ';

Â  Â  Â  editButton.onclick = function () {

Â  Â  Â  Â  let currentText = notaData.texto || notaData.nota || '';

Â  Â  Â  Â  const editInput = document.createElement('textarea');

Â  Â  Â  Â  editInput.value = currentText;

Â  Â  Â  Â  editInput.style.width = '100%';

Â  Â  Â  Â  editInput.style.height = '100px';

Â  Â  Â  Â  editInput.style.resize = 'none';

Â  Â  Â  Â  editInput.style.overflowY = 'auto';

Â  Â  Â  Â  const noteContainer = card.querySelector('.note-content');

Â  Â  Â  Â  if (noteContainer) {

Â  Â  Â  Â  Â  noteContainer.innerHTML = '';

Â  Â  Â  Â  Â  noteContainer.appendChild(editInput);

Â  Â  Â  Â  }

Â  Â  Â  Â  const saveEditButton = document.createElement('button');

Â  Â  Â  Â  saveEditButton.classList.add('menu-icon');

Â  Â  Â  Â  saveEditButton.innerHTML = 'ğŸ’¾';

Â  Â  Â  Â  saveEditButton.onclick = function () {

Â  Â  Â  Â  Â  const newText = editInput.value;

Â  Â  Â  Â  Â  if (newText.trim() !== '') {

Â  Â  Â  Â  Â  Â  db.collection('notas').doc(doc.id)

Â  Â  Â  Â  Â  Â  Â  .update(notaData.url ? { texto: newText } : { nota: newText })

Â  Â  Â  Â  Â  Â  Â  .then(() => {

Â  Â  Â  Â  Â  Â  Â  Â  const noteContainer = card.querySelector('.note-content');

Â  Â  Â  Â  Â  Â  Â  Â  noteContainer.innerHTML = linkify(newText);

Â  Â  Â  Â  Â  Â  Â  Â  menuBar.replaceChild(editButton, saveEditButton);

Â  Â  Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  Â  Â  .catch((error) => { console.error('Error al actualizar la nota: ', error); });

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â  menuBar.replaceChild(saveEditButton, editButton);

Â  Â  Â  };

Â  Â  Â  // BotÃ³n de eliminar

Â  Â  Â  const deleteButton = document.createElement('button');

Â  Â  Â  deleteButton.classList.add('menu-icon');

Â  Â  Â  deleteButton.innerHTML = 'âœ–';

Â  Â  Â  deleteButton.onclick = function () {

Â  Â  Â  Â  db.collection('notas').doc(doc.id).delete()

Â  Â  Â  Â  Â  .then(() => {

Â  Â  Â  Â  Â  Â  grid.removeWidget(gridItem);

Â  Â  Â  Â  Â  Â  // Elimina el indicador de la bolita asignada en el calendario

Â  Â  Â  Â  Â  Â  document.querySelectorAll(".assigned-bubble[data-note='"+doc.id+"']").forEach(b => b.remove());

Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  .catch((error) => { console.error("Error al eliminar la nota: ", error); });

Â  Â  Â  };

Â  Â  Â  // Contenedor para los botones de editar y eliminar (juntos)

Â  Â  Â  const editDeleteContainer = document.createElement('div');

Â  Â  Â  editDeleteContainer.style.display = 'flex';

Â  Â  Â  editDeleteContainer.style.gap = '4px';

Â  Â  Â  editDeleteContainer.appendChild(editButton);

Â  Â  Â  editDeleteContainer.appendChild(deleteButton);

Â  Â  Â  // Se agregan los controles: primero la bolita, luego el grupo edit/delete

Â  Â  Â  menuBar.appendChild(bubbleButton);

Â  Â  Â  menuBar.appendChild(editDeleteContainer);

Â  Â  Â Â 

Â  Â  Â  card.appendChild(menuBar);

Â  Â  Â  content.appendChild(card);

Â  Â  Â  gridItem.appendChild(content);



Â  Â  Â  const pos = {

Â  Â  Â  Â  x: notaData.x || 0,

Â  Â  Â  Â  y: typeof notaData.y === 'number' ? notaData.y : 0,

Â  Â  Â  Â  w: notaData.w || 2,

Â  Â  Â  Â  h: notaData.h || 2,

Â  Â  Â  Â  autoPosition: (notaData.x === undefined || notaData.y === undefined)

Â  Â  Â  };

Â  Â  Â  grid.addWidget(gridItem, pos);

Â  Â  }

Â  Â  function limpiarNotasDisplay() { grid.removeAll(); }

Â  Â  db.collection('notas').orderBy('__name__')

Â  Â  Â  .onSnapshot((snapshot) => {

Â  Â  Â  Â  limpiarNotasDisplay();

Â  Â  Â  Â  snapshot.forEach((doc) => { mostrarNotaEnPantalla(doc); });

Â  Â  Â  });

Â  Â Â 

Â  Â  /****************** Manejo de la Interfaz para Agregar Notas ******************/

Â  Â  const addNoteButton = document.getElementById('addNoteButton');

Â  Â  const addNoteOptions = document.getElementById('addNoteOptions');

Â  Â  const addImageLinkOption = document.getElementById('addImageLinkOption');

Â  Â  const addTextNoteOption = document.getElementById('addTextNoteOption');

Â  Â  const inputArea = document.getElementById('inputArea');

Â  Â  const imageLinkInputArea = document.getElementById('imageLinkInputArea');

Â  Â  const imageLinkInput = document.getElementById('imageLink');

Â  Â  const saveImageLinkButton = document.getElementById('saveImageLink');

Â  Â  const textNoteInputArea = document.getElementById('textNoteInputArea');

Â  Â  const saveTextNoteButton = document.getElementById('saveTextNote');

Â  Â  const blurBackground = document.querySelector('.blur-background');

Â  Â  let addingNewNote = false;

Â  Â Â 

Â  Â  function hideMenus() {

Â  Â  Â  addNoteOptions.style.display = 'none';

Â  Â  Â  inputArea.style.display = 'none';

Â  Â  Â  blurBackground.style.display = 'none';

Â  Â  Â  addingNewNote = false;

Â  Â  }

Â  Â  addNoteButton.onclick = function (event) {

Â  Â  Â  event.stopPropagation();

Â  Â  Â  addingNewNote = !addingNewNote;

Â  Â  Â  if (addingNewNote) {

Â  Â  Â  Â  addNoteOptions.style.display = 'flex';

Â  Â  Â  Â  blurBackground.style.display = 'block';

Â  Â  Â  } else { hideMenus(); }

Â  Â  };

Â  Â  addImageLinkOption.onclick = function (event) {

Â  Â  Â  event.stopPropagation();

Â  Â  Â  addNoteOptions.style.display = 'none';

Â  Â  Â  inputArea.style.display = 'flex';

Â  Â  Â  imageLinkInputArea.style.display = 'block';

Â  Â  Â  textNoteInputArea.style.display = 'none';

Â  Â  Â  blurBackground.style.display = 'block';

Â  Â  Â  addingNewNote = false;

Â  Â  };

Â  Â  addTextNoteOption.onclick = function (event) {

Â  Â  Â  event.stopPropagation();

Â  Â  Â  addNoteOptions.style.display = 'none';

Â  Â  Â  inputArea.style.display = 'flex';

Â  Â  Â  imageLinkInputArea.style.display = 'none';

Â  Â  Â  textNoteInputArea.style.display = 'block';

Â  Â  Â  blurBackground.style.display = 'block';

Â  Â  Â  addingNewNote = false;

Â  Â  };

Â  Â  blurBackground.onclick = function () { hideMenus(); };

Â  Â Â 

Â  Â  function guardarLinkDeImagen() {

Â  Â  Â  let link = imageLinkInput.value;

Â  Â  Â  const texto = imageNoteText.value;

Â  Â  Â  if (link.trim() !== '') {

Â  Â  Â  Â  link = transformDriveLink(link);

Â  Â  Â  Â  db.collection('notas').add({

Â  Â  Â  Â  Â  url: link,

Â  Â  Â  Â  Â  texto: texto.trim() !== '' ? texto : null

Â  Â  Â  Â  })

Â  Â  Â  Â  Â  .then(() => { imageLinkInput.value = ''; imageNoteText.value = ''; hideMenus(); })

Â  Â  Â  Â  Â  .catch((error) => { console.error('Error al guardar el link de imagen: ', error); });

Â  Â  Â  }

Â  Â  }

Â  Â  function guardarNotaTexto() {

Â  Â  Â  const nota = textNoteInput.value;

Â  Â  Â  if (nota.trim() !== '') {

Â  Â  Â  Â  db.collection('notas').add({ nota: nota })

Â  Â  Â  Â  Â  .then(() => { textNoteInput.value = ''; hideMenus(); })

Â  Â  Â  Â  Â  .catch((error) => { console.error('Error al guardar la nota de texto: ', error); });

Â  Â  Â  }

Â  Â  }

Â  Â  saveImageLinkButton.onclick = guardarLinkDeImagen;

Â  Â  saveTextNoteButton.onclick = guardarNotaTexto;

Â  Â Â 

Â  Â  grid.on('dragstop', function (event, el) {

Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  const noteId = el.getAttribute('data-note-id');

Â  Â  Â  Â  const node = el.gridstackNode;

Â  Â  Â  Â  if (noteId && node) {

Â  Â  Â  Â  Â  db.collection('notas').doc(noteId).update({

Â  Â  Â  Â  Â  Â  x: node.x, y: node.y, w: node.w, h: node.h

Â  Â  Â  Â  Â  }).catch(error => console.error("Error guardando posiciÃ³n:", error));

Â  Â  Â  Â  }

Â  Â  Â  }, 100);

Â  Â  });

Â  Â Â 

Â  Â  /****************** Calendario y AsignaciÃ³n de la Bolita ******************/

Â  Â  let currentCalendarMonth, currentCalendarYear;

Â  Â  function getChileDate() {

Â  Â  Â  return new Date(new Date().toLocaleString("en-US", { timeZone: "America/Santiago" }));

Â  Â  }

Â  Â  function initCalendarDate() {

Â  Â  Â  let today = getChileDate();

Â  Â  Â  let year = today.getFullYear();

Â  Â  Â  let month = today.getMonth();

Â  Â  Â  if (year < 2024 || (year === 2024 && month < 11)) {

Â  Â  Â  Â  return { month: 11, year: 2024 };

Â  Â  Â  }

Â  Â  Â  return { month, year };

Â  Â  }

Â  Â  function getMonthName(monthIndex) {

Â  Â  Â  const months = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

Â  Â  Â  return months[monthIndex];

Â  Â  }

Â  Â  function generateCalendar(month, year) {

Â  Â  Â  const calendarDiv = document.getElementById('calendarWidget');

Â  Â  Â  calendarDiv.innerHTML = '';

Â  Â  Â  const header = document.createElement('div');

Â  Â  Â  header.className = 'calendar-header';

Â  Â  Â  const prevBtn = document.createElement('button');

Â  Â  Â  prevBtn.textContent = '<';

Â  Â  Â  prevBtn.onclick = function () {

Â  Â  Â  Â  let newMonth = month - 1, newYear = year;

Â  Â  Â  Â  if (newMonth < 0) { newMonth = 11; newYear--; }

Â  Â  Â  Â  if (newYear < 2024 || (newYear === 2024 && newMonth < 11)) return;

Â  Â  Â  Â  generateCalendar(newMonth, newYear);

Â  Â  Â  };

Â  Â  Â  const nextBtn = document.createElement('button');

Â  Â  Â  nextBtn.textContent = '>';

Â  Â  Â  nextBtn.onclick = function () {

Â  Â  Â  Â  let newMonth = month + 1, newYear = year;

Â  Â  Â  Â  if (newMonth > 11) { newMonth = 0; newYear++; }

Â  Â  Â  Â  generateCalendar(newMonth, newYear);

Â  Â  Â  };

Â  Â  Â  const title = document.createElement('span');

Â  Â  Â  title.textContent = getMonthName(month) + ' ' + year;

Â  Â  Â  header.appendChild(prevBtn);

Â  Â  Â  header.appendChild(title);

Â  Â  Â  header.appendChild(nextBtn);

Â  Â  Â  calendarDiv.appendChild(header);

Â  Â  Â Â 

Â  Â  Â  const daysHeader = document.createElement('div');

Â  Â  Â  daysHeader.className = 'calendar-days-header';

Â  Â  Â  ['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'].forEach(day => {

Â  Â  Â  Â  const dayElem = document.createElement('div');

Â  Â  Â  Â  dayElem.textContent = day;

Â  Â  Â  Â  dayElem.className = 'calendar-day';

Â  Â  Â  Â  daysHeader.appendChild(dayElem);

Â  Â  Â  });

Â  Â  Â  calendarDiv.appendChild(daysHeader);

Â  Â  Â Â 

Â  Â  Â  const datesGrid = document.createElement('div');

Â  Â  Â  datesGrid.className = 'calendar-dates-grid';

Â  Â  Â  const firstDay = new Date(year, month, 1).getDay();

Â  Â  Â  const daysInMonth = new Date(year, month + 1, 0).getDate();

Â  Â  Â Â 

Â  Â  Â  for (let i = 0; i < firstDay; i++) {

Â  Â  Â  Â  const emptyCell = document.createElement('div');

Â  Â  Â  Â  emptyCell.className = 'calendar-date empty';

Â  Â  Â  Â  datesGrid.appendChild(emptyCell);

Â  Â  Â  }

Â  Â  Â  for (let date = 1; date <= daysInMonth; date++) {

Â  Â  Â  Â  const dateCell = document.createElement('div');

Â  Â  Â  Â  dateCell.className = 'calendar-date';

Â  Â  Â  Â  dateCell.textContent = date;

Â  Â  Â  Â  dateCell.style.minHeight = '30px';

Â  Â  Â  Â  dateCell.style.paddingBottom = '8px';

Â  Â  Â  Â  dateCell.addEventListener('dragover', function(e){ e.preventDefault(); });

Â  Â  Â  Â  dateCell.addEventListener('drop', function(e) {

Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  const noteId = e.dataTransfer.getData("application/note-id");

Â  Â  Â  Â  Â  if (noteId) {

Â  Â  Â  Â  Â  Â  const assignedDate = `${date}/${month+1}/${year}`;

Â  Â  Â  Â  Â  Â  db.collection('notas').doc(noteId)

Â  Â  Â  Â  Â  Â  Â  .update({ assignedDate: assignedDate })

Â  Â  Â  Â  Â  Â  Â  .then(() => console.log('Fecha asignada:', assignedDate))

Â  Â  Â  Â  Â  Â  Â  .catch((error) => console.error('Error asignando fecha:', error));

Â  Â  Â  Â  Â  Â  // Agregar el indicador en la celda y marcar con atributo para saber a quÃ© nota pertenece

Â  Â  Â  Â  Â  Â  if (!e.currentTarget.querySelector(".assigned-bubble")) {

Â  Â  Â  Â  Â  Â  Â  const assigned = document.createElement("span");

Â  Â  Â  Â  Â  Â  Â  assigned.classList.add("assigned-bubble");

Â  Â  Â  Â  Â  Â  Â  // Almacenar el id de la nota en un atributo data

Â  Â  Â  Â  Â  Â  Â  assigned.setAttribute("data-note", noteId);

Â  Â  Â  Â  Â  Â  Â  assigned.textContent = "â—";

Â  Â  Â  Â  Â  Â  Â  e.currentTarget.appendChild(assigned);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Ocultar la bolita en la nota

Â  Â  Â  Â  Â  Â  const bubble = document.getElementById("bubble-" + noteId);

Â  Â  Â  Â  Â  Â  if (bubble) { bubble.style.display = "none"; }

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  Â  datesGrid.appendChild(dateCell);

Â  Â  Â  }

Â  Â  Â  const totalCells = firstDay + daysInMonth;

Â  Â  Â  const cellsToAdd = 42 - totalCells;

Â  Â  Â  for (let i = 0; i < cellsToAdd; i++) {

Â  Â  Â  Â  const emptyCell = document.createElement('div');

Â  Â  Â  Â  emptyCell.className = 'calendar-date empty';

Â  Â  Â  Â  datesGrid.appendChild(emptyCell);

Â  Â  Â  }

Â  Â  Â  calendarDiv.appendChild(datesGrid);

Â  Â  Â  currentCalendarMonth = month;

Â  Â  Â  currentCalendarYear = year;

Â  Â  }

Â  Â  function openCalendar() {

Â  Â  Â  const { month, year } = initCalendarDate();

Â  Â  Â  generateCalendar(month, year);

Â  Â  Â  document.getElementById('calendarWidget').style.display = 'block';

Â  Â  }

Â  Â  const calendarIcon = document.getElementById('calendarIcon');

Â  Â  const calendarWidget = document.getElementById('calendarWidget');

Â  Â  let calendarTimeout;

Â  Â  function showCalendar() {

Â  Â  Â  const { month, year } = initCalendarDate();

Â  Â  Â  generateCalendar(month, year);

Â  Â  Â  calendarWidget.style.display = 'block';

Â  Â  }

Â  Â  function hideCalendar() {

Â  Â  Â  calendarTimeout = setTimeout(() => { calendarWidget.style.display = 'none'; }, 200);

Â  Â  }

Â  Â  calendarIcon.addEventListener('mouseover', () => { clearTimeout(calendarTimeout); showCalendar(); });

Â  Â  calendarIcon.addEventListener('mouseout', hideCalendar);

Â  Â  calendarWidget.addEventListener('mouseover', () => { clearTimeout(calendarTimeout); calendarWidget.style.display = 'block'; });

Â  Â  calendarWidget.addEventListener('mouseout', hideCalendar);

Â  Â Â 

Â  Â  /****************** Prevenir que clics en los menÃºs propaguen para no cerrar el blur ******************/

Â  Â  document.getElementById('addNoteOptions').addEventListener('click', function(e){ e.stopPropagation(); });

Â  Â  document.getElementById('inputArea').addEventListener('click', function(e){ e.stopPropagation(); });

Â  </script>

</body>

</html>
